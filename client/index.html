<!DOCTYPE HTML>
<HTML>
<head>
      <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
      <link rel="stylesheet" type="text/css" href="/css/styles.css">
      <!-- <link href="/styles.css"> -->
      <script type="text/javascript;charset=utf-8" async src="js/inventory.js"></script>
</head>
<script src="js/entity.js"></script>
<script src="js/levelEditor.js"></script>
<script src="js/levelLoad.js"></script>
<script src="js/levelSave.js"></script>
<script src="js/inventory.js"></script>
<script src="js/CampaignManager.js"></script>

<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
<body>

		<div id="menuWrapper"> <!-- wrapper for centering Menus -->

			<!--- Sign in Div Below -->

									<div id="menuDiv">  <!-- This is for the main menus -->
										<div id ="logoIMG">
											<img src="./img/Uni_X.png" alt="game logo">
										</div>
										<div id="signDiv">
											<input id="signDiv-username" type="text" placeholder="Username"> </input><br>
											<input id="signDiv-password" type="password" placeholder="Password"></input>
											<button class="button1" id="signDiv-signIn">Sign In</button>
											<button class="button1" id="signDiv-signUp">Sign Up</button>
										</div>

										<div id="mainMenu" style="display:none;">
												<button class="button2" id="profile">Profile </button>
												<button class="button2" id="newGame">New Game</button>
												<button class="button2" id="loadGame">Load Game</button>
												<button class="button2" id="levelEditorB">Level Editor</button>

										</div>

										<div id="campaignInput" style="display:none; text-align: center;">
												<form>
													<input type="text" id="playerName" placeholder="Player Name"><br>
													<input class="ngRadio" type="radio"  name="difficulty" value="0" checked> Easy<br>
													<input class="ngRadio" type="radio"  name="difficulty" value="1"> Medium<br>
													<input class="ngRadio" type="radio"  name="difficulty" value="2"> Hard
												</form>
													<button class="button3" id="startNewGame">Start New Game</button>
											</div>

																<!-- All files had the same id
												Will need to connect to database -->
											<div id="loadFile" style="display:none;">
												<p>Campaigns</p>
													<!-- <button id="file">File One</button>
													<button id="file">File Two</button>
													<button id="file">File Three</button> -->
											</div>

											<div id="playerProfile" style ="display:none;">
												UserName : <input type="text" id="username" value=username>
												token : <input type="text" id="token" value=token>
												levelEditorString : <input type="text" id="level" value=saveLevel()>
										</div>

										<div id="back" style ="display:none;">
											<button class="button1" onclick="backMainMenu()">Back</button>
											</div>


										<div id="profileDiv" style ="display:none;">
													<button onclick="showProfile()">Profile</button>
										</div>

								</div>

		</div>



		<div id="deathScreen" style="display:none;" >
			<div id ="logoIMG">
				<img src="./img/FAIL.png" alt="game logo">
			</div>
			<button onclick="afterdeath()" class = "button3"> Go Back to Campus </button>
		</div>

            <div id="deathScreenLE" style="display:none;" >
                  <div id ="logoIMG">
                        <img src="./img/FAIL.png" alt="game logo">
                  </div>
                  <button onclick="afterdeathLE()" class = "button3"> Go Back to Level Editor </button>
            </div>

		<div id="succsessScreen" style="display:none;" >
			<div id ="logoIMG">
				<img src="./img/youpassed.png" alt="game logo">
			</div>
			<div id="stats">
				<h2 id="levelHeading">You completed the time in: </h2>

			</div>
			<button onclick="aftersuccess()" class = "button3"> Go Back to Campus </button>
		</div>

	<div id="coursesButtonGroup">
		<div id="mathMenu" style="display:none;">

			<h2 id="levelHeading"> Choose which Math Level to Play: </h2>

				<button class="button3" id="MATH1000">Math 1000</button>
				<button class="button3" id="MATH2000">Math 2000</button>
				<button class="button3" id="MATH3000">Math 3000</button>
				<button class="button3" id="MATH4000">Math 4000</button>
				<button class="button3" id="backCourse">Back</button>

		</div>

		<div id="physMenu" style="display:none;">

				<h2 id="levelHeading"> Choose which Physics Level to Play: </h2>

					<button class="button3" id="PHYS1000">Physics 1000</button>
					<button class="button3" id="PHYS2000">Physics 2000</button>
					<button class="button3" id="PHYS3000">Physics 3000</button>
					<button class="button3" id="PHYS4000">Physics 4000</button>
					<button class="button3" id="backCourse">Back</button>

			</div>

			<div id="compMenu" style="display:none;">

					<h2 id="levelHeading"> Choose which Computer Science Level to Play: </h2>

						<button class="button3" id="COMP1000">Computer Science 1000</button>
						<button class="button3" id="COMP2000">Computer Science 2000</button>
						<button class="button3" id="COMP3000">Computer Science 3000</button>
						<button class="button3" id="COMP4000">Computer Science 4000</button>
						<button class="button3" id="backCourse">Back</button>

				</div>

				<div id="philMenu" style="display:none;">

						<h2 id="levelHeading"> Choose which Philosophy Level to Play: </h2>

							<button class="button3" id="PHIL1000">Philoshophy 1000</button>
							<button class="button3" id="PHIL1000">Philoshophy 2000</button>
							<button class="button3" id="PHIL1000">Philoshophy 3000</button>
							<button class="button3" id="PHIL1000">Philoshophy 4000</button>
							<button class="button3" id="backCourse">Back</button>

					</div>

                  <div id="landscapingWork" style="display:none;">

											<h2 id="levelHeading">Welcome to your Dad's Landscaping</h2>

												<button class="button3" id="LandscapeButton">Go to Work</button>
												<button class="button3" id="backCourse">Back</button>

      					</div>
</div>




<div id="gameDiv" style="display:none;">
		<button class="specialBack" onclick="backMainMenu()">Back</button>
	<div id="game" style="position:absolute;width:1280px;height:720px">
		<canvas id="ctx" width="1280" height="720" style="position:absolute;border:1px solid #000000;"></canvas>
		<canvas id="ctx-ui" width="1280" height="720" style="position:absolute;border:1px solid #000000;"></canvas>
	</div>
</div>

<div id="levelEditor" style="display:none;">
	<div id="editor" style="position:absolute;width:1280px;height:720px;">
		<canvas id="ctxLE" width="1280" height="720" style="position:absolute;border:1px solid #000000;"></canvas>
		<canvas id="ctx_uiLE" width="1280" height="720" style="position:absolute;border:1px solid #000000;"></canvas>

	</div>
      <div id="aSelect1" style ="position: fixed; bottom: 50px; right: 0;">
            <select id="selections";>
                  <option value="p"selected="selected">Player</option>
                  <option value="e">Enemy</option>
                  <option value="f">Platform</option>
				  <option value="b">Breakable</option>
				  <option value="a">Assignment</option>
				  <option value="m">Midterm</option>
				  <option value="l">Final</option>
                  <option value="d">Delete</option>
            </select>
      </div>
	<div id="aSelect2" style ="position: fixed; bottom: 50px; right: 110px;">
            <select id="background" onchange="facChange()">
				<option id="math" value="img/math1.png" selected="selected">Math</option>
				<option id="phil" value="img/phil1.png">Philosophy</option>
				<option id="phys" value="img/phy1.png">Physics</option>
				<option id="comp" value="img/cs1.png">Computer Science</option>
			</select>

	</div>
	<div id="backLE" style="display:none;position:absolute;bottom: 50px;">
		<button onclick="backMainMenu()">Back</button>
	</div>
	<div id="save" style ="display:none;position:absolute;bottom: 50px;left:50px">
            <button id="savebutton">Save</button>
	</div>
	<div id="play" style="display:none;position:absolute;bottom: 50px;left:100px;">
		<button id="play">Play</button>
	</div>
	<div id="loadSelect" style="display:none;position:absolute;bottom: 50px;left:200px;">
		<select id="selections2" ;>
			<option id="l" value="p" selected disabled>Levels</option>

		</select>
	</div>
	<div id="load" style ="display:none;position:absolute;bottom: 50px;left:150px">
            <button id="loadbutton">Load</button>
	</div>
</div>


<!-- <div id="selections" style ="display:none;">
      <select>
            <option value="asset1">asset1</option>
            <option value="asset2">asset2</option>
            <option value="asset3">asset3</option>
      </select>
</div> -->


<script>
	var username = "";
	var token = "";
	let canvas=document.getElementById('ctx');
    let canvasG=document.getElementById('ctx_uiLE');
	let ctx=canvas.getContext('2d');
	let canvasLE=document.getElementById('ctxLE');
	let ctxLE=canvasLE.getContext('2d');
    let ctx_uiLE = canvasG.getContext('2d');
	let canvasui=document.getElementById('ctx-ui');
	let ctxui=canvasui.getContext('2d');
      let fromLe = false;
      let levelSTR;
      let levelW;


	let  snd = new Audio("music/Good Will Hunting OST - 02 The Theorem.mp3");
         let  snd2 = new Audio("music/Winterbells Extended Original song.mp3");


	let deathY=0;
	let start=Date.now();
  let signDivSignIn = document.getElementById('signDiv-signIn');
  let signDivSignUp = document.getElementById('signDiv-signUp');
  let newGame = document.getElementById('newGame');
  let loadGame = document.getElementById('loadGame');
  let levelEditorB = document.getElementById('levelEditorB');
  let loadFile = document.getElementById('loadFile');
  //let file = document.getElementById('file');
  let a1 = document.getElementById('selections');
let a3 = document.getElementById('selections2');
	let a2 = document.getElementById('loadSelect');
	let loadButton= document.getElementById('loadbutton')
	let play=document.getElementById('play');
	let save = document.getElementById('save');
	let usernameText=document.getElementById('username');
	let profile=document.getElementById('profile');
	let tokenText=document.getElementById('token');
	let saveLevelText=document.getElementById('level');
	let keyUp=87;
	let keyDown=83;
	let keyRight=68;
	let keyLeft=65;
	let keyPause=80;
	let keyGrapple=32;
	let keyChange=67;
	let weaponPowerUpsChange = 81;
	let powerUpsChange = 82;
	let weaponPowerUp;
	let powerUp;
	let wPUCount = 0;
	let PUCount = 0;
	let W=1280;
	let H=720;
	let screen='sign';
	let count=0;
	let check=true
	let leDraw=false;
	let levelEditorLevels;
	//moveScreen=MoveScreen(0,0,);
	let campaign;
	let campaignInput = document.getElementById('campaignInput');
	let startNewGame = document.getElementById('startNewGame');
	moveScreen=MoveScreen(0,0,);
	let FAC='math';
   	let inTown = false;
	let money;
	let gammaHP;
	let dadCredit;
	let workCredit;
      let land = document.getElementById('LandscapeButton');

  var Img = {};
  Img.playerLevel = new Image();
  Img.playerLevel.src = "img/player_level.png";
	Img.penLeft=new Image();
	Img.penLeft.src="img/pen_left.png";
	Img.penRight=new Image();
	Img.penRight.src="img/pen_right.png";
	Img.philEnemy=new Image();
	Img.philEnemy.src="img/philEnemy.png";
	Img.mathEnemy=new Image();
	Img.mathEnemy.src="img/gauss_open.png";
	Img.phyEnemy=new Image();
	Img.phyEnemy.src="img/Albert_open.png";
	Img.csEnemy=new Image();
	Img.csEnemy.src="img/turing_open.png";
	Img.platform=new Image();
	Img.platform.src="img/tile.png";
	Img.breakable=new Image();
	Img.breakable.src="img/break_tile.png";
	Img.midterm=new Image();
	Img.midterm.src="img/midterm.png";
	Img.upgrade=new Image();
	Img.upgrade.src="img/powerup.png";
	Img.bgMath=new Image();
	Img.bgMath.src="img/math1.png";
	Img.bgPhy=new Image();
	Img.bgPhy.src="img/phy1.png";
	Img.bgPhil=new Image();
	Img.bgPhil.src="img/phil1.png";
	Img.bgCs=new Image();
	Img.bgCs.src="img/cs1.png";
	Img.town=new Image();
	Img.town.src="img/town.png";
	Img.campus=new Image();
	Img.campus.src="img/campus.png";

	let bg="img/math1.png";

      let updateMoney = function() {
            if (workCredit > 0){
                  console.log("Money before: " + money);
                  money = money + 400;
                  console.log("Money after: " + money);
                  workCredit--;
            }
            else {
                  levelFailed();
            }
      }



	var isFirxFox = function () {
	            return navigator.userAgent.indexOf("Firefox") > 0 ? true : false;
	        }

	        var clickHandler = function (target) {
				if(target == "backCourse"){
					leaveRoom();
				}
                        else if (target == "LandscapeButton") {
                              updateMoney(); // make update money
                              leaveRoom();
                        }
				else{
					leaveRoom();
					loadCourseLevel(target);
				}

	        }

	        var coursesButtonGroup = document.getElementById("coursesButtonGroup");

	        coursesButtonGroup.addEventListener("click", function (event) {

	            var targetId;
	            if (isFirxFox()) {
	                //for Firefox
	                targetId = event.target.id;
	            }
	            else {
	                //For IE, Chrome
	                targetId = event.srcElement.id;
	            }
	            clickHandler(targetId);



	        });

	//testing collision of rectangles
	testCollisionRects = function(rect1,rect2){
	return rect1.x <= rect2.x+rect2.width
		&& rect2.x <= rect1.x+rect1.width
		&& rect1.y <= rect2.y + rect2.height
		&& rect2.y <= rect1.y + rect1.height;
	}

	//action listeners, logic tbd
	document.onmousedown=function(mouse){
		if(mouse.which==1){
			if (screen=='game'||screen=='overworld') {
				player.lMouseClick=true;
			}
			else if(screen=='le'){
				let selection = selections.options[selections.selectedIndex].value;
				mousePos.code=selection;
				console.log(mousePos.code);
				//let x=mousePos.x-moveScreen.right*64;
				//let y=mousePos.y-moveScreen.down*64;
				//console.log(x+', '+y);
				if(leDraw){
					mousePos.draw();
				}
			}
		}
		else{
			player.rMouseClick=true;
		}
	}
	document.onmouseup=function(mouse){
		if(mouse.which==1){
			player.lMouseClick=false;
		}
		else{
			player.rMouseClick=false;
		}
	}
	document.oncontextmenu=function(mouse){
		mouse.preventDefault();
	}
	document.onmousemove=function(mouse){
	let mouseX = mouse.clientX - canvas.getBoundingClientRect().left;
	let mouseY = mouse.clientY - canvas.getBoundingClientRect().top;



      if (screen=='game'||screen=='overworld') {
            mouseX -= W/2;
			mouseY -= H/2;
            player.aimAngle = Math.atan2(mouseY,mouseX) / Math.PI * 180;
      }
      else if(screen=='le'){
			if(mouseY>18&&mouseY<738&&mouseX>0&&mouseX<1280){
				mousePos.x=mouseX;
				// mousePos.y=mouseY-3+moveScreen.left*64;
				mousePos.y = mouseY-20;
				//console.log("mouseX: " + mouseX + "mouseY: " + mouseY);
				leDraw=true;
			}
			else{
			leDraw=false;
			}
      }

	}
	document.onkeydown=function(event){
		if(screen=='game'||screen=='overworld'){
			if(event.keyCode==keyUp) {
				player.upPress=true;
				}
			else if(event.keyCode==keyDown) {
				player.downPress=true;
				}
			else if(event.keyCode==keyRight){
				player.rightPress=true;
				}
			else if(event.keyCode==keyLeft) {
				player.leftPress=true;
			}
			else if(event.keyCode==keyPause) {
				//add logic to pause
            }
			else if(event.keyCode==keyGrapple) {
				player.grapplePress=true;
            }
			else if(event.keyCode==keyChange){
				if(player.weap==0){
					player.weap=1;
				}
				else{
					player.weap=0;
				}
			}
			else if(event.keyCode == weaponPowerUpsChange){
				cycleWeaponPowerUps();
			}
			else if(event.keyCode == powerUpsChange){
				cyclePowerUps();
			}
		}
		else if(screen=='le'){
			if(event.keyCode==keyUp){
				if(mousePos.yoff<0){
					mousePos.yoff++;
				}
			}
			else if(event.keyCode==keyDown){
				mousePos.yoff--;
			}
			else if(event.keyCode==keyRight){
				mousePos.xoff--;
			}
			else if(event.keyCode==keyLeft){
				if(mousePos.xoff<0){
					mousePos.xoff++;
				}
			}
		}
	}
	document.onkeyup=function(event){
		if(event.keyCode==keyUp)
			player.upPress=false;
		else if(event.keyCode==keyDown)
			player.downPress=false;
		else if(event.keyCode==keyRight)
			player.rightPress=false;
		else if(event.keyCode==keyLeft)
			player.leftPress=false;
		else if(event.keyCode==keyPause) {
			//add logic to pause
            }
		else if(event.keyCode==keyGrapple)
			player.grapplePress=false;
	}

	//update for in game, logic tbd
	update=function(){
		/*	console.log(player.x + "and" + player.y);*/
            if (screen == 'overworld' && !inTown) {
                  campusBoundaries();
                  if (player.x < -25) {
                        inTown = true;
                        player.x = 1200;
                  }
                  if ((player.x > 630 && player.x < 690) && (player.y > 160 && player.y < 180)) {
                        console.log("Entered CS Building");
												enterRoom("COMP");
                  }
									else if ((player.x > 940 && player.x < 980) && (player.y > 190 && player.y < 210)) {
                        console.log("Entered Physics Building");
											//*enterRoom("PHYS");
                  }
									else if ((player.x > 960 && player.x < 1050) && (player.y > 650 && player.y < 670)) {
                        console.log("Entered Math Building");
									//*enterRoom("MATH");
                  }
									else if ((player.x > 640 && player.x < 670) && (player.y > 645 && player.y < 670)) {
                        console.log("Entered Philosophy Building");
									//*enterRoom("PHIL");
                  }
            }
            else if (inTown && screen == 'overworld') {
                  townBoundaries();
                  if (player.x > 1200) {
                        inTown = false;
                        player.x = 25;
                  }
                  if ((player.x < 140 && player.x > 60) && (player.y < 435 && player.y > 295)) {
                        console.log("Entered Work");
                        enterRoom("LAND");
                  }
            }


		let bgImg=new Image();
            if (screen == "le" || screen == "game") {
				if(FAC=="math"){
					bgImg.src='img/math1.png';
				}
				else if(FAC=="phil"){
					bgImg.src="img/phil1.png";
				}
				else if(FAC=="phys"){
					bgImg.src="img/phy1.png";
				}
				else if(FAC=="comp"){
					bgImg.src="img/cs1.png";
				}
            }
            else if (screen == 'overworld') {
                  if (!inTown) {
                        bgImg.src= 'img/campus.png';
                  }
                  else {
                        bgImg.src= 'img/town.png';
                  }
            }
			if(screen=='game'||screen=='overworld'){
				ctx.clearRect(0, 0, W, H);
				ctx.drawImage(bgImg,0,0,W,H);
				ctxui.clearRect(0,0,W,H);
				ctxui.font="35px Arial";
				if(screen=='game'){
					ctxui.strokeText("HP: "+player.hp,50,50);
					if(campaign != null){
						ctxui.strokeText("WPU :" + weaponPowerUp, 50, 90);
						ctxui.strokeText("PU :" + powerUp, 50, 130);
					}
					else{
						ctxui.strokeText("WPU :" + weaponPowerUp, 50, 90);
						ctxui.strokeText("PU :" + powerUp, 50, 130);

					}
                    ctxui.fillstyle = "white";
                    ctxui.stokestle = "white";


				}
				if(screen=='overworld'){
					ctxui.fillText("Money: "+money,50,50);
					ctxui.fillText("Dad Credits: "+dadCredit,300,50);
					ctxui.fillText("Work Credits: "+workCredit,600,50);
                              ctxui.fillstyle = "white";
                              ctxui.stokestle = "white";
				}

			}
			else if(screen=='le'){
				ctxLE.clearRect(0,0,W,H);
				ctxLE.drawImage(bgImg,0,0,W,H);
			}
                  player.update();
			Enemy.update();
			Projectile.update();
			Final.update();
                  if (screen == 'game' || screen =='le') {
                        Platform.update();
                  }

			Upgrade.update();
            //console.log("Player (X,Y): " + "(" + player.x + ", " + player.y + ")");
			//console.log("Player aim angle is: "+player.aimAngle);
			//console.log("Grapple key = "+player.grapplePress);
			//console.log("Attack Speed: "+player.atkSpd+" Attack Counter: "+player.atkCnt);
      }

	let facChange=function(){
		if(document.getElementById('background').value=='img/math1.png'){
			FAC='math';
			Enemy.facChange();
		}
		else if(document.getElementById('background').value=='img/phil1.png'){
			FAC='phil';
			Enemy.facChange();
		}
		else if(document.getElementById('background').value=='img/phy1.png'){
			FAC='phys';
			Enemy.facChange();
		}
		else if(document.getElementById('background').value=='img/cs1.png'){
			FAC='comp';
			Enemy.facChange();
		}
	}

    function valid(userName,pass){
			if (!isEmpty(userName) && !isEmpty(pass) ){
					return true;
				}

			}
	function isEmpty(str) {
		return (!str || 0 === str.length);
	}


	signDivSignUp.onclick = function() {
		user=document.getElementById('signDiv-username').value;
		pass=document.getElementById('signDiv-password').value;

		if (valid(user,pass)){
			var socket = io();
			socket.emit('signUp',{
			username:user, password:pass ,
			});
    	socket.on('accountCreated', function(message){
				console.log(message);
				if (message.accountCreated==true) console.log("account Created");
			});
		}
  }

	signDivSignIn.onclick = function() {
      console.log("signDivSignIn HIT")
			user=document.getElementById('signDiv-username').value;
			pass=document.getElementById('signDiv-password').value;


			let check=true

			if (valid(user,pass && check)){
				check=false;
				var socket = io();
				socket.emit('signIn',{
				username:user, password:pass ,
				});

				socket.on('signedIn', function(message){            //AccountManager
					console.log(message);

					msg=message;
					token = message.token;


					console.log(message.signedIn);
					if (message.signedIn==true){

					username=message.userName;
					token=message.token;
					tokenText.value=token;
					usernameText.value=username;
					snd2.play();
					let playerName="mario";
					let diffuculty="hard";
					let progress="false"   ; //used for mid-term
					let inventory="1001";


				  saveLevelText.value=saveLevel("john","mario","mission","hard","true","10001",0,0,0,0);

					console.log("welcome  : "  +message.userName  ) ;
					console.log("your token is  :"  +message.token);

					document.getElementById('signDiv-password').value;
					signDiv.style.display = 'none';
					mainMenu.style.display = 'inline-block';


					//playerProfile.style.display = 'inline-block';
					back.style.display = 'inline';
					//screen='menu';


				}


				});

				}

	}



	function backMainMenu(){
   console.log("s " + screen);
		if (screen=="menu"){
			mainMenu.style.display = 'none';
			back.style.display = 'none';
			backLE.style.display = 'none';
			playerProfile.style.display = 'none';
			signDiv.style.display = 'inline-block';
			campaignInput.style.display = 'none';
		}




		if (screen=="le" || screen =="game" || screen=="overworld"){
			levelEditor.style.display = 'none';
      selections.style.display = 'none';
			loadFile.style.display = 'none';
			gameDiv.style.display = 'none';

			back.style.display = 'none';

			//gameDiv.style.display = 'inline-block';
			menuWrapper.style.display = "inline-block";
      mainMenu.style.display = 'inline-block';
			back.style.display = 'inline';
			screen="menu";
		}
			//console.log("count " + count);


	}





save.onclick = function () {
			let socket = io();
			console.log("save button HIT");
			level = prompt("Please enter your Level name ", "enter new Level name :");
			if (level != null) {
				console.log("level name " + level);
				socket.emit('saveLevel', {
					username:username,
					levels: saveLevel(username, level, 2, mousePos.xmax, mousePos.ymax),
				});
			}
		}



	loadButton.onclick = function () {
		loadLevel(levelEditorLevels[a3.options[a3.selectedIndex].index -1].Level, levelEditorLevels[a3.options[a3.selectedIndex].index -1].Width);
		//loadLevel("e0e0e0e000e0e0e000000000000f0000000f0000f00000000000000000p0000",9);
	}



	levelFailed=function(){
		gameDiv.style.display='none';
		signDiv.style.display = 'none';
            landscapingWork.style.display = 'none';

		//menuWrapper.style.display='inline-block'; //Reapperaing menu wrapper
		//mainMenu.style.display = 'inline-block';
            if (fromLe == false) {
		                //deathScreen.style.display = 'inline-block';
                      }
                  else {
                        deathScreenLE.style.display = 'inline-block';
                        fromLe = false;
                  }
	}


	function afterdeath(){
		deathScreen.style.display = 'none';
		leaveRoom();
		Entity.clear();
	}

      afterdeathLE = function() {
            deathScreenLE.style.display = 'none';
            Entity.clear();
            levelEditor.style.display = 'inline-block';
            screen = "le";
            loadLevel(levelSTR, levelW);
      }

	levelCompleted=function(){
		gameDiv.style.display='none';
		signDiv.style.display = 'none';

		succsessScreen.style.display = 'inline-block';

		//menuWrapper.style.display='inline-block'; //Reapperaing menu wrapper
		//mainMenu.style.display = 'inline-block';
		screen='menu';
		let compTime=Date.now()-start;
		console.log('Completed level in '+compTime+' ms.');
		Entity.clear();
	}

	function aftersuccess(){
		succsessScreen.style.display = 'none';
		leaveRoom();
		Entity.clear();
	}

	//console.log("string :" + saveLevel(0,0,0,0));

	play.onclick=function(){
            fromLe = true;
            console.log("mousePos.xmax: "  + mousePos.xmax + ", " + "mousePos.ymax: " + mousePos.ymax);
            saveLevelLE(mousePos.xmax, mousePos.ymax);
            console.log("LevelSTR: " + levelSTR + ", LevelW: " + levelW);
		gameDiv.style.display="inline-block";
		menuWrapper.style.display="none"; //Getting rid of the menu wrapper
		levelEditor.style.display = 'none';
		// save.style.display = 'none';
		// backLE.style.display="none";
		// play.style.display="none";
		screen='game';
		start=Date.now();
	}

      newGame.onclick = function() {
		  campaignInput.style.display = "flex";
		  mainMenu.style.display ="none";
      }


	  startNewGame.onclick = function(){
    	let socket=io();
			menuWrapper.style.display = "none";
  		let info = {
  			playerName : document.getElementById('playerName').value,
  			difficulty : document.querySelector('input[name=difficulty]:checked').value
  		};
		//let playerNameCheat = checkCampaignPlayerNameCheat(document.getElementById('playerName').value);
		if (checkCampaignPlayerNameCheat(document.getElementById('playerName').value) == true){
			info.difficulty = 3;
		}
		console.log(info);
    		socket.emit('createCampaign',{
  			username: username,
  			info : info

    		});

			socket.on('campaignCreated', function(message){
				console.log(message);
				campaign = message.campaign;
				console.log(campaign);
			  gammaHp=Math.floor((Math.random())*4);
			  gammaHP++;
			  money=message.campaign.SaveFile.saves[0].money;
			  dadCredit=message.campaign.SaveFile.saves[0].dadCredit;
			  workCredit=message.campaign.SaveFile.saves[0].workCredit;
			  weaponPowerUp = message.campaign.SaveFile.saves[0].inventory.weaponPowerUps[0].itemName;
			  powerUp = message.campaign.SaveFile.saves[0].inventory.powerUps[0].itemName;
			});
			gameDiv.style.display="inline-block";
                  campaignInput.style.display ="none";
                  // player.x = 300;
                  // player.y = 350;
                  // if (player.x < 0) {
                  //       console.log("o");
                  // }
                  // screen = 'overworld';


				  loadOverworld();
			//loadCourseLevel("PHYS1000");

	  }

	  loadOverworld = function(){
			Entity.clear();
		  menuWrapper.style.display = "none";
		  gameDiv.style.display="inline-block";
		  loadFile.style.display = "none";
          player.x = 300;
          player.y = 350;
          if (player.x < 0) {
                console.log("o");
          }
          screen = 'overworld';
	  }

	   loadCourseLevel  = function(courseName){
                console.log("HERE");
		//  let socket=io();
  		//socket.emit('loadSystemCourseLevel',{
		//	courseName: courseName
  		//});

		//socket.on('systemCourseLevelFound', function(message){
			//console.log(message.courseLevel);


			gameDiv.style.display="inline-block";
			menuWrapper.style.display ='none'; //hiding menu wrapper
			levelEditor.style.display = 'none';
			save.style.display = 'none';
			backLE.style.display="none";
			play.style.display="none";
			campaignInput.style.display="none";
			start=Date.now();
			loadLevel('00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000l0000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000p00000000000000e000000000000000000000000000000000000000000000000000000m0000000000000a0000000000000000000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000a000000000bb0b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffff0000000000000000bbbb0bbbbb000b00000000ffff000000000000000000000000000000000bbbbbb0000ffff0fff0000000000000000000000000000000000000000000000000000000000000000000000f0000000000000000000000f000000000000000000000000000000000000000000000000000000000000000000000000000000000b0e000000000000000000ff0000000000000000000ff000000e000000000000f0ff00000000000000000000000000000fffff0000000000000000000f0fff000000000000000000000b00b0000000000000000000fff00000000ffffff0000000000000000000000000000000000000000000ffffffffffffff00fa00f00000fff000000000000000000000000000000000000bbbbb00b00000be00000000ffff0000000000000000f0f0f0000000000000000000000000000000000000000000000000000f000f00000befe0000000000000000000000000000000000bbb0a000bbfffffbbb000000ffff0000000000000000000000000ee0000000000000000000fef00f0000000000000000000f0f000000000fff00000000f00000000f00f00000fffffffffffffffffffffffffffffffffffffffffffff000000ffffffffffffffffffffff00fffffffffffffffffffffffffffffffffffffffffffffffffffff000ffffffffffffffffffw',148);
                  console.log("Makes it to loaded level");
                  screen='game';

		//});
	  }

      loadGame.onclick = function() {
			mainMenu.style.display = 'none';
            loadFile.style.display = 'inline-block';
		    screen='game';
			loadUserCampaigns();

      }

      // file.onclick = function () {
      //       loadFile.style.display = 'none';
      //       gameDiv.style.display = 'inline-block';
      // }

			profile.onclick= function  () {
            playerProfile.style.display = 'inline-block';
						mainMenu.style.display = 'none';
						console.log("profile hit");
      }


	  enterRoom = function(roomName){
		   coursesButtonGroup.style.display = 'inline';
		  if(roomName == "COMP"){
			 compMenu.style.display = 'inline-block';
		  }
			else if(roomName == "MATH"){
			 mathMenu.style.display = 'inline-block';
		  }
			else if(roomName == "PHYS"){
			 physMenu.style.display = 'inline-block';
		  }
			else if(roomName == "PHIL"){
			 philMenu.style.display = 'inline-block';
		  }
                  else if(roomName == "LAND"){
                   compMenu.style.display = 'none';
                   menuWrapper.style.display = "none";
    		       gameDiv.style.display="none";
                   landscapingWork.style.display = 'inline-block';
                    //screen = menu;
              }

	  }

	  leaveRoom = function(roomName){
		  coursesButtonGroup.style.display = 'none';
		  compMenu.style.display = 'inline-block';
              compMenu.style.display = 'inline-block';
		  loadOverworld();
	  }


	getSavedUserLevels = function () {
			let socket = io();
			console.log("load button HIT");

			socket.emit('getUserLevels', { username: username });
			socket.on('userLevelsFound', function (message) {
				levelEditorLevels = message.Levels;
				var option = document.createElement("s");
				for (var x = 0; x < message.Levels.length; x++) {
					console.log(message.Levels[x].Levelname);
					let optionLevel = document.createElement("option");
					optionLevel.text = message.Levels[x].Levelname;
					a3.add(optionLevel);
				}
				console.log(message);
			});

		}


		loadUserCampaigns = function(){
			let socket = io();
			socket.emit('getUserCampaigns',{token: token});
                  console.log("Makes it to loadUserCampaigns");
			socket.on('loadUserCampaigns', function(message){
				console.log(message.campaigns);
				Campaigns = message.campaigns;
				loadFile.innerHTML = "";
				for(var x=0; x<message.campaigns.length; x++){
					buildCampaignListButton(message.campaigns[x]);
				}

			});
		}
			let savesCounter = 0;
			let userSaves;
		loadCampaignSaveFiles = function(campaignNumber){
			let socket = io();
  			let saveHeader = document.createElement("P");
  			let t = document.createTextNode("Saves From Campaign " + campaignNumber);
			saveHeader.appendChild(t);
			if (savesCounter == 0){
				//loadFile.innerHTML = "";
	  			loadFile.appendChild(saveHeader);
				savesCounter = 1;
			}
			else{
				//console.log(loadFile);
				loadFile.removeChild(loadFile.lastElementChild);
				loadFile.removeChild(loadFile.lastElementChild);
	  			loadFile.appendChild(saveHeader);

			}
			socket.emit('getUserCampaignSaves', {token: token, campaignNumber: campaignNumber});
			socket.on('loadUserCampaignSaves', function(message){
				for(var x=0; x<message.saves.length; x++){
					buildSavesButton(message.saves[x]);
				}
				userSaves = message.saves;
			});

		}

		buildSavesButton = function(saveInfo){
  			var save = document.createElement("button");
  			var t = document.createTextNode("Save " + saveInfo.saveNumber);
			save.setAttribute("onclick", "loadSavedGame("+ saveInfo.saveNumber + ")");
  			save.appendChild(t);
  			loadFile.appendChild(save);
		}

		loadSavedGame = function(saveNumber){
			let count = 0;
			for(var x=0; x<userSaves.length;x++){
				if(userSaves[x].saveNumber == saveNumber){
					console.log(userSaves[x]);
					money = userSaves[x].money;
					gammaHP = userSaves[x].gammaHP;
					dadCredit = userSaves[x].dadCredit;
					workCredit = userSaves[x].workCredit;
					count = x;
					weaponPowerUp = userSaves[x].inventory.weaponPowerUps[0].itemName;
					powerUp = userSaves[x].inventory.powerUps[0].itemName;
					loadOverworld();

				}
			}
			userSaves = userSaves[count];
		}

		buildCampaignListButton = function(CampaignInfo){
			var campaignButton = document.createElement("button");
			var t = document.createTextNode(CampaignInfo.campaignNumber);
			campaignButton.setAttribute("onclick", "loadCampaignSaveFiles(" + CampaignInfo.campaignNumber + ")");
			campaignButton.appendChild(t);
			loadFile.appendChild(campaignButton);
		}


		cycleWeaponPowerUps = function(){
			wPUCount++;
			if (campaign == null){
				if(wPUCount >= userSaves.inventory.weaponPowerUps.length -1){wPUCount = 0;}
				weaponPowerUp = userSaves.inventory.weaponPowerUps[wPUCount].itemName;
				console.log(userSaves.inventory.weaponPowerUps[wPUCount].itemName);
				//ctxui.strokeText("PU :" + campaign.SaveFile.saves[0].inventory.powerUps[0].itemName, 50, 130);
			}else{
				if(wPUCount > campaign.SaveFile.saves[0].inventory.weaponPowerUps.length -1){wPUCount = 0;}
				weaponPowerUp =  campaign.SaveFile.saves[0].inventory.weaponPowerUps[wPUCount].itemName;
				console.log(campaign.SaveFile.saves[0].inventory.weaponPowerUps[wPUCount].itemName + wPUCount)


			}
		}

		cyclePowerUps = function(){
			PUCount++;
			if (campaign == null){
				if(PUCount >= userSaves.inventory.powerUps.length -1){PUCount = 0;}
				powerUp = userSaves.inventory.powerUps[PUCount].itemName;
				console.log(userSaves.inventory.powerUps[PUCount].itemName);
				//ctxui.strokeText("PU :" + campaign.SaveFile.saves[0].inventory.powerUps[0].itemName, 50, 130);
			}else{
				if(PUCount > campaign.SaveFile.saves[0].inventory.powerUps.length -1){PUCount = 0;}
				powerUp =  campaign.SaveFile.saves[0].inventory.powerUps[PUCount].itemName;
				console.log(campaign.SaveFile.saves[0].inventory.powerUps[PUCount].itemName + PUCount)


			}
		}




   levelEditorB.onclick = function () {
			Entity.clear();
			getSavedUserLevels();
			mainMenu.style.display = 'none';
			menuWrapper.style.display = "none";
			selections.style.display = 'inline';
			a2.style.display = 'inline';
			levelEditor.style.display = 'inline-block';
			save.style.display = 'inline-block';
			load.style.display = 'inline-block';
			back.style.display = "none";
			backLE.style.display = "inline-block";
			play.style.display = 'inline-block';
			for (let i = 0; i < 1280; i += 64) {
				ctx_uiLE.beginPath();
				ctx_uiLE.moveTo(i, 0)
				ctx_uiLE.lineTo(i, 720);
				ctx_uiLE.stroke();
			}
			for (let i = 0; i < 720; i += 64) {
				ctx_uiLE.beginPath();
				ctx_uiLE.moveTo(0, i);
				ctx_uiLE.lineTo(1280, i);
				ctx_uiLE.stroke();
			}



	   		 snd2.muted=true;
                        snd.play();

			//play.style.display="inline-block";
			screen = 'le';
			console.log(screen);
		}

      campusBoundaries = function() {
            for (let key in Platform.list) {
                  delete Platform.list[key];
            }
            Platform.generate(665, 110); // door
            Platform.generate(740, 190);
            Platform.generate(800, 175);
            Platform.generate(845, 270);
            Platform.generate(835, 400);
            Platform.generate(835, 460);
            Platform.generate(740, 500);
            Platform.generate(510, 520);
            Platform.generate(480, 400);
            Platform.generate(550, 185);
            Platform.generate(455, 230);
            Platform.generate(385, 145);
            Platform.generate(1035, 220);
            Platform.generate(955, 140);
            Platform.generate(1000, 145);
            Platform.generate(1000, 120);
            Platform.generate(950, 120);
            Platform.generate(1200, -5);
            Platform.generate(1240, 65);
            Platform.generate(640, 105);
            Platform.generate(640, 41);
            Platform.generate(640, 30);
            Platform.generate(670, 30);
            Platform.generate(980, 600); //door
            Platform.generate(800, 175);
            Platform.generate(1020, 570);
            Platform.generate(1020, 550);
            Platform.generate(980, 500);
            Platform.generate(1012, 500);
            Platform.generate(950, 540);
            Platform.generate(660, 600);
            Platform.generate(665, 335);
            Platform.generate(350, 145);
            Platform.generate(350, 81);
            Platform.generate(414, 70);
            Platform.generate(430, 70);
            Platform.generate(430, 134);
            screen = 'overworld';
      }

      townBoundaries = function() {
            for (let key in Platform.list) {
                  delete Platform.list[key];
            }
            Platform.generate(775, 500);
            Platform.generate(745, 500);
            Platform.generate(839, 500);
            Platform.generate(910, 610);
            Platform.generate(755, 625);
            Platform.generate(570, 455);
            Platform.generate(480, 570);
            Platform.generate(280, 590);
            Platform.generate(280, 526);
            Platform.generate(70, 580);
            Platform.generate(555, 300);
            Platform.generate(645, 55);
            Platform.generate(565, 30);
            Platform.generate(365, 45);
            Platform.generate(365, 0);
            Platform.generate(415, 240);
            Platform.generate(351, 240);
            Platform.generate(287, 240);
            Platform.generate(125, 75);
            Platform.generate(189, 35);
            Platform.generate(75, 370);
            Platform.generate(0, 370);
            Platform.generate(0, 420);


      }

      // <!--  drawing to canvus and moving -->

      //let ctx = document.getElementById('ctx').getContext('2d');

      // let player = {
      //       x:50,
      //       y:50,
      // };
    player = Player(-64, -64);
	mousePos=MousePos(0,0,0,0,'p');
      //var img = new Image()

      // img.onload = function() {
      //
      //
      //     ctx.drawImage(img, 0, 0);
      //
      // };

      //img.src = "img/Armature_Idle_12.png";

	//if(gameDiv.style.display!="none"){
       setInterval(update, 30);
	//}

      //ctx.fillRect(Player.x, player.y, 20, 20);

</script>
</body>
<!-- <style>
      selections {
            position: absolute;
            right: 1290px;

      }
</style> -->
</HTML>
